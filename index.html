<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>My Grocery Lists</title>

  <!--
    === Default Lists ===
    Edit these multiline blocks right here to change your starting items.
  -->
  <script>
    // Veggies: one item per line
    const defaultVeggiesText = `
‡§ü‡§Æ‡§æ‡§ü‡§∞
Avocado
Pears
‡§Ö‡§¶‡§∞‡§ï
‡§ï‡§¶‡•ç‡§¶‡•Ç
‡§ï‡•á‡§≤‡•á
‡§®‡•Ä‡§Ç‡§¨‡•Ç
‡§™‡§æ‡§≤‡§ï
‡§™‡•Å‡§¶‡•Ä‡§®‡§æ
‡§™‡•ç‡§Ø‡§æ‡§ú
‡§¨‡•à‡§Ç‡§ó‡§®
‡§≠‡§ø‡§Ç‡§°‡•Ä
‡§Æ‡•á‡§•‡•Ä
‡§≤‡§æ‡§≤ ‡§∏‡•á‡§¨
‡§∂‡§ï‡§∞‡§ï‡§Ç‡§¶‡•Ä
‡§π‡§∞‡§æ ‡§ß‡§®‡§ø‡§Ø‡§æ
‡§π‡§∞‡•á ‡§∏‡•á‡§¨
‡§ñ‡•Ä‡§∞‡§æ
Avocado
Beans
Beetroot
Broccoli
Corn
Kiwi
‡§Ö‡§Ç‡§ó‡•Ç‡§∞
‡§ó‡§æ‡§ú‡§∞
‡§§‡§∞‡§¨‡•Ç‡§ú
‡§™‡§™‡•Ä‡§§‡§æ
‡§™‡•ç‡§Ø‡§æ‡§ú
‡§≤‡§π‡§∏‡•Å‡§®
‡§≤‡•ã‡§ï‡•Ä
‡§∂‡§ø‡§Æ‡§≤‡§æ ‡§Æ‡§ø‡§∞‡•ç‡§ö
‡§∏‡§Ç‡§§‡§∞‡•á (Kunal)
‡§∏‡§Ç‡§§‡§∞‡•á for ‡§ú‡•Ç‡§∏
`.trim();

    // Grocery: one item per line
    const defaultGroceryText = `
Bin bags
Bread
Buns
Chicken
Chicken Ng.
Detergent
Dish Tablets
Dish. Liquid
Dish. Ringe.
Eggs
Full Cr. Milk
Hard Butter
Kids Snack
Pizza Base
Pizza Cheese
Potato
Pre-wash
Soft Butter
Sugar
Woolwash
`.trim();

    // Indian store: one item per line
    const defaultIndianText = `
‡§Ü‡§ü‡§æ
‡§ö‡§æ‡§µ‡§≤
‡§™‡•ã‡§π‡§æ
‡§¶‡§æ‡§≤:
‡§∞‡§æ‡§à
‡§¶‡§≤‡§ø‡§Ø‡§æ
‡§¨‡•á‡§∏‡§®
‡§∏‡§∞‡§∏‡•ã‡§Ç ‡§§‡•á‡§≤
`.trim();
  </script>

  <style>
    :root {
      --veggies-color:   #4caf50;
      --grocery-color:   #2196f3;
      --indian-color:    #ff9800;
      --checked-color:   #e9ecef;
      --master-check:    #673ab7;
      --reset-color:     #f44336;
      --share-color:     #4caf50;
      --reorder-color:   #ff5722;
      --highlight:       #fff9c4;
      --undo-highlight:  #e3f2fd;
    }
    * { box-sizing:border-box; }
    body {
      margin:0; padding:70px 15px 80px;
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:#f5f7fa; color:#333;
      touch-action:pan-y;
    }
    h1 {
      text-align:center;
      margin-bottom:25px;
      font-size:2.16rem;
    }
    /* Top buttons */
    .action-buttons {
      position:absolute; top:15px; left:15px; right:15px;
      display:flex; gap:30px; z-index:100;
    }
    .action-btn {
      display:flex; align-items:center; gap:.5em;
      padding:.6em 1em;
      border:none; border-radius:12px;
      color:#fff; font-size:1rem; cursor:pointer;
      box-shadow:0 2px 8px rgba(0,0,0,0.2);
    }
    .action-btn .icon { font-size:1.2rem;}
    .master-check { background:var(--master-check); }
    .reset-btn     { background:var(--reset-color); }
    .share-btn     { background:var(--share-color); }
    .reorder-btn   { background:var(--reorder-color); }

    /* List containers */
    .list-container {
      margin-bottom:30px;
      background:#fff; border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.05);
      overflow:hidden;
    }
    .list-header {
      padding:15px; font-size:1.56rem; font-weight:bold;
      color:#fff;
      display:flex; justify-content:space-between; align-items:center;
      cursor:pointer;
    }
    #veggies-header { background:var(--veggies-color); }
    #grocery-header { background:var(--grocery-color); }
    #indian-header  { background:var(--indian-color); }
    .collapse-btn {
      background:none; border:none; color:#fff;
      font-size:1.8rem; cursor:pointer;
    }

    /* Items */
    ul.item-list {
      list-style:none; margin:0; padding:0;
    }
    ul.item-list li {
      display:flex; align-items:center; gap:8px;
      padding:12px 10px; border-bottom:1px solid #eee;
      position:relative; overflow:hidden;
      background:#fff;
      transition:transform .3s ease, opacity .3s ease;
    }
    ul.item-list li.swipe-delete {
      transform:translateX(-100%); opacity:0;
    }
    ul.item-list li.checked {
      background:var(--checked-color)!important;
      color:#6c757d;
    }
    ul.item-list li.checked .item-name {
      text-decoration:line-through;
      opacity:.7;
    }

    /* Checkbox */
    .row-checkbox {
      width:31px; height:31px;
      appearance:none;
      border:2px solid #666; border-radius:4px;
      position:relative; cursor:pointer; flex-shrink:0;
    }
    .row-checkbox:checked {
      background:#666; border-color:#666;
    }
    .row-checkbox:checked::after {
      content:"‚úì"; color:#fff; font-size:21.6px;
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%);
    }
    #veggies li .row-checkbox:checked {
      background:var(--veggies-color); border-color:var(--veggies-color);
    }
    #grocery li .row-checkbox:checked {
      background:var(--grocery-color); border-color:var(--grocery-color);
    }
    #indian  li .row-checkbox:checked {
      background:var(--indian-color); border-color:var(--indian-color);
    }

    /* Name input */
    .item-name {
      flex:1; min-width:0;
      font-size:1.92rem; padding:7px;
      border:none; background:transparent; outline:none;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
      transition:background .3s, font-weight .3s;
    }
    .item-name.active {
      background:var(--highlight);
      font-weight:bold;
      border-radius:4px;
    }

    /* Counter */
    .counter {
      display:flex; align-items:center; gap:6px;
      flex-shrink:0; transition:background .3s ease;
    }
    .counter.active {
      background:var(--highlight);
      border-radius:20px; padding:2px 6px;
    }
    .counter.active .counter-btn,
    .counter.active .counter-value {
      background:var(--highlight)!important;
      color:#333!important;
    }
    .counter-btn {
      width:38px; height:38px;
      border:none; border-radius:50%;
      color:#fff; font-weight:bold; font-size:1.2rem;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; flex-shrink:0;
    }
    #veggies li .counter-btn { background:var(--veggies-color); }
    #grocery li .counter-btn { background:var(--grocery-color); }
    #indian  li .counter-btn { background:var(--indian-color); }
    .counter-btn:disabled {
      opacity:.5; cursor:not-allowed;
    }
    .counter-value {
      min-width:30px; text-align:center;
      font-size:1.32rem; font-weight:normal;
      transition:font-weight .3s ease;
    }

    /* Add item button */
    .add-btn {
      width:48px; height:48px; margin:0 10px 10px;
      border-radius:50%; background:var(--master-check);
      color:#fff; border:none; font-size:1.8rem;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
    }

    /* Swipe delete indicator */
    .swipe-delete-indicator {
      position:absolute; right:-100px; top:0; bottom:0;
      width:100px; background:#f44336; color:#fff;
      display:flex; align-items:center; justify-content:center;
      font-weight:bold; font-size:1.2rem;
      transition:right .3s ease;
    }
    /* Undo toast */
    .undo-notification {
      position:fixed; bottom:20px; left:50%;
      transform:translateX(-50%);
      background:#333; color:#fff;
      padding:12px 24px; border-radius:6px;
      display:flex; align-items:center; gap:12px;
      font-size:1.2rem; z-index:1000;
    }
    .undo-btn {
      background:var(--share-color); color:#fff;
      border:none; padding:6px 12px; border-radius:3.6px;
      cursor:pointer; font-size:1.2rem;
    }
    .undo-highlight {
      background:var(--undo-highlight)!important;
    }

    @media(max-width:600px){
      body { padding:70px 10px 80px; font-size:19.2px; }
      .action-buttons { gap:20px; }
      .action-btn { font-size:.9rem; padding:.5em .8em; }
      .item-name { font-size:1.44rem; }
      .counter-btn { width:36px; height:36px; }
      .counter-value { font-size:1.2rem; }
      .add-btn { width:42px; height:42px; font-size:1.6rem; }
    }
  </style>
</head>
<body>

  <div class="action-buttons">
    <button class="action-btn master-check" onclick="toggleAll()">
      <span class="icon">‚úì</span> Toggle All
    </button>
    <button class="action-btn reset-btn" onclick="resetAll()">
      <span class="icon">üîÑ</span> Reset
    </button>
    <button class="action-btn share-btn" onclick="shareList()">
      <span class="icon">‚§¥</span> Share
    </button>
    <button class="action-btn reorder-btn" onclick="reorderAll()">
      <span class="icon">üõí</span> Reorder
    </button>
  </div>

  <h1>My Grocery Lists</h1>

  <!-- Veggies -->
  <div class="list-container">
    <div class="list-header" id="veggies-header" onclick="toggleList('veggies')">
      Veggies <button class="collapse-btn">‚ñº</button>
    </div>
    <ul id="veggies" class="item-list"></ul>
    <button class="add-btn" onclick="addItem('veggies')">Ôºã</button>
  </div>

  <!-- Grocery -->
  <div class="list-container">
    <div class="list-header" id="grocery-header" onclick="toggleList('grocery')">
      Grocery <button class="collapse-btn">‚ñº</button>
    </div>
    <ul id="grocery" class="item-list"></ul>
    <button class="add-btn" onclick="addItem('grocery')">Ôºã</button>
  </div>

  <!-- Indian Store -->
  <div class="list-container">
    <div class="list-header" id="indian-header" onclick="toggleList('indian')">
      Indian Store <button class="collapse-btn">‚ñº</button>
    </div>
    <ul id="indian" class="item-list"></ul>
    <button class="add-btn" onclick="addItem('indian')">Ôºã</button>
  </div>

  <script>
    // Build `lists` from those default text blocks in <head>
    const lists = {
      veggies: {
        id: 'veggies',
        collapsed: false,
        default: defaultVeggiesText.split('\n')
      },
      grocery: {
        id: 'grocery',
        collapsed: false,
        default: defaultGroceryText.split('\n')
      },
      indian: {
        id: 'indian',
        collapsed: false,
        default: defaultIndianText.split('\n')
      }
    };

    let touchStartX = 0, touchEndX = 0, currentRow = null, deleted = [];

    document.addEventListener('DOMContentLoaded', () => {
      // Restore collapsed states & initialize data
      const savedStates = JSON.parse(localStorage.getItem('collapsedStates') || '{}');
      for (let name in lists) {
        lists[name].collapsed = savedStates[name] || false;
        updateCollapse(name);

        // load or initialize items
        let arr = JSON.parse(localStorage.getItem(name) || '[]');
        const allPlaceholder = Array.isArray(arr)
          && arr.length > 0
          && arr.every(i => i.name.trim().toLowerCase() === name);
        if (!arr.length || allPlaceholder) {
          arr = lists[name].default.map(n => ({
            name: n,
            count: '0',
            checked: false
          }));
          localStorage.setItem(name, JSON.stringify(arr));
        }
        loadList(name);
      }
      setupSwipe();
    });

    // Collapse / expand
    function toggleList(name) {
      lists[name].collapsed = !lists[name].collapsed;
      updateCollapse(name);
      const out = {};
      for (let k in lists) out[k] = lists[k].collapsed;
      localStorage.setItem('collapsedStates', JSON.stringify(out));
    }
    function updateCollapse(name) {
      const ul = document.getElementById(name);
      const btn = document.querySelector(`#${name}-header .collapse-btn`);
      if (lists[name].collapsed) {
        ul.style.display = 'none'; btn.textContent = '‚ñ∂';
      } else {
        ul.style.display = 'block'; btn.textContent = '‚ñº';
      }
    }

    // Swipe-to-delete
    function setupSwipe() {
      document.body.addEventListener('touchstart', e => {
        const li = e.target.closest('li');
        if (li && !e.target.closest('.counter') && !e.target.matches('.row-checkbox') && !e.target.matches('.item-name')) {
          touchStartX = e.changedTouches[0].screenX;
          currentRow = li;
          if (!li.querySelector('.swipe-delete-indicator')) {
            const ind = document.createElement('div');
            ind.className = 'swipe-delete-indicator';
            ind.textContent = 'DELETE';
            li.style.position = 'relative';
            li.appendChild(ind);
          }
        }
      }, {passive:true});

      document.body.addEventListener('touchmove', e => {
        if (!currentRow) return;
        touchEndX = e.changedTouches[0].screenX;
        const diff = touchStartX - touchEndX,
              threshold = window.innerWidth * 0.5;
        if (diff > 30) {
          const tx = Math.min(diff, threshold);
          currentRow.style.transform = `translateX(-${tx}px)`;
          const ind = currentRow.querySelector('.swipe-delete-indicator');
          if (ind) ind.style.right = `-${tx}px`;
        }
      }, {passive:true});

      document.body.addEventListener('touchend', e => {
        if (!currentRow) return;
        const diff = touchStartX - touchEndX,
              threshold = window.innerWidth * 0.5;
        if (diff > threshold) {
          deleteWithUndo(currentRow);
        } else {
          currentRow.style.transform = '';
          const ind = currentRow.querySelector('.swipe-delete-indicator');
          if (ind) ind.style.right = '-100px';
        }
        currentRow = null;
      });
    }

    function deleteWithUndo(li) {
      const listName = getListName(li);
      li.classList.add('swipe-delete');
      const record = {
        html:      li.innerHTML,
        id:        li.id,
        list:      listName,
        index:     Array.from(li.parentNode.children).indexOf(li)
      };
      deleted.push(record);
      showUndo();
      setTimeout(() => {
        if (!record.undo) {
          li.remove();
          saveList(listName);
        }
      }, 300);
    }
    function showUndo() {
      document.querySelectorAll('.undo-notification').forEach(n=>n.remove());
      const n = document.createElement('div');
      n.className = 'undo-notification';
      n.innerHTML = `Item deleted <button class="undo-btn" onclick="undo()">UNDO</button>`;
      document.body.appendChild(n);
    }
    function undo() {
      document.querySelectorAll('.undo-notification').forEach(n=>n.remove());
      if (!deleted.length) return;
      const record = deleted.pop();
      record.undo = true;
      const ul = document.getElementById(record.list);
      let li = document.getElementById(record.id);
      if (li) {
        li.classList.remove('swipe-delete');
        li.style.transform = '';
        li.classList.add('undo-highlight');
        setTimeout(()=>li.classList.remove('undo-highlight'),2000);
      } else {
        li = document.createElement('li');
        li.id = record.id;
        li.innerHTML = record.html;
        if (record.index < ul.children.length) {
          ul.insertBefore(li, ul.children[record.index]);
        } else {
          ul.appendChild(li);
        }
        li.classList.add('undo-highlight');
        setTimeout(()=>li.classList.remove('undo-highlight'),2000);
        wireRow(li);
      }
      saveList(record.list);
    }

    // Share only qty>0
    function shareList() {
      let text = '';
      for (let key in lists) {
        const arr = JSON.parse(localStorage.getItem(key) || '[]');
        const pick = arr.filter(i => parseInt(i.count,10) > 0);
        if (pick.length) {
          text += `${key.toUpperCase()}:\n`
               + pick.map(i => `${i.name} (${i.count})`).join('\n')
               + '\n\n';
        }
      }
      text = text.trim();
      if (!text) return alert('Nothing to share‚Äîno items have >0 quantity.');
      if (navigator.share) {
        navigator.share({ title:'My Grocery List', text, url:location.href })
          .catch(()=>{ copyToClipboard(text); alert('Copied to clipboard'); });
      } else {
        copyToClipboard(text); alert('Copied to clipboard');
      }
    }
    function copyToClipboard(s) {
      const ta = document.createElement('textarea');
      ta.value = s; document.body.appendChild(ta);
      ta.select(); document.execCommand('copy'); ta.remove();
    }

    // Reset everything
    function resetAll() {
      if (!confirm('Reset all counters, uncheck items, and expand lists?')) return;
      document.querySelectorAll('li').forEach(li => {
        li.querySelector('.row-checkbox').checked = false;
        li.classList.remove('checked','undo-highlight');
        const cv = li.querySelector('.counter-value');
        cv.textContent = '0';
        li.querySelectorAll('.counter-btn').forEach(b=>b.disabled = (b.textContent==='-'));
        li.querySelector('.item-name').classList.remove('active');
        li.querySelector('.counter').classList.remove('active');
      });
      for (let key in lists) saveList(key);
      localStorage.removeItem('collapsedStates');
    }

    // Toggle all
    function toggleAll() {
      if (!confirm('Toggle all checkboxes?')) return;
      const boxes = Array.from(document.querySelectorAll('.row-checkbox'));
      const anyChecked = boxes.some(cb => cb.checked);
      boxes.forEach(cb => {
        cb.checked = !anyChecked;
        cb.closest('li').classList.toggle('checked', cb.checked);
      });
      for (let key in lists) saveList(key);
    }

    // Reorder (bring qty>0 to top)
    function reorderAll() {
      for (let key in lists) {
        const ul = document.getElementById(key);
        const items = Array.from(ul.children);
        const have = items.filter(li => parseInt(li.querySelector('.counter-value').textContent,10) > 0);
        const zero = items.filter(li => parseInt(li.querySelector('.counter-value').textContent,10) === 0);
        have.concat(zero).forEach(li => ul.appendChild(li));
      }
    }

    // Add new item
    function addItem(listName) {
      const ul = document.getElementById(listName);
      const li = document.createElement('li');
      li.id = 'li-'+Date.now();
      li.innerHTML = `
        <input type="checkbox" class="row-checkbox"
               onchange="toggleItem(this,'${listName}')">
        <input type="text" class="item-name" placeholder="Item name"
               oninput="saveList('${listName}')">
        <div class="counter">
          <button class="counter-btn" onclick="change(this,-1)" disabled>-</button>
          <span class="counter-value">0</span>
          <button class="counter-btn" onclick="change(this,1)">+</button>
        </div>
      `;
      ul.appendChild(li);
      wireRow(li);
      saveList(listName);
    }

    // Change counter
    function change(btn, delta) {
      const li = btn.closest('li');
      const cv = li.querySelector('.counter-value');
      let v = parseInt(cv.textContent,10);
      v = Math.max(0, Math.min(50, v+delta));
      cv.textContent = v;
      const [neg, pos] = li.querySelectorAll('.counter-btn');
      neg.disabled = v <= 0; pos.disabled = v >= 50;

      // highlight when >0
      if (v > 0) {
        li.querySelector('.item-name').classList.add('active');
        li.querySelector('.counter').classList.add('active');
        cv.style.fontWeight = 'bold';
      } else {
        li.querySelector('.item-name').classList.remove('active');
        li.querySelector('.counter').classList.remove('active');
        cv.style.fontWeight = 'normal';
      }
      saveList(getListName(li));
    }

    // Toggle a single row
    function toggleItem(cb, listName) {
      const li = cb.closest('li');
      li.classList.toggle('checked', cb.checked);
      saveList(listName);
    }

    // Save & load helpers
    function saveList(name) {
      const data = Array.from(document.getElementById(name).children).map(li => ({
        name:    li.querySelector('.item-name').value,
        count:   li.querySelector('.counter-value').textContent,
        checked: li.querySelector('.row-checkbox').checked
      }));
      localStorage.setItem(name, JSON.stringify(data));
    }
    function loadList(name) {
      const arr = JSON.parse(localStorage.getItem(name) || '[]');
      const ul = document.getElementById(name);
      ul.innerHTML = '';
      arr.forEach(item => {
        const li = document.createElement('li');
        li.id = 'li-'+Date.now()+Math.random().toString(36).slice(2,5);
        li.innerHTML = `
          <input type="checkbox" class="row-checkbox"
                 onchange="toggleItem(this,'${name}')"
                 ${item.checked?'checked':''}>
          <input type="text" class="item-name"
                 oninput="saveList('${name}')"
                 value="${item.name.replace(/"/g,'&quot;')}">
          <div class="counter">
            <button class="counter-btn" onclick="change(this,-1)"
                    ${item.count<=0?'disabled':''}>-</button>
            <span class="counter-value">${item.count}</span>
            <button class="counter-btn" onclick="change(this,1)"
                    ${item.count>=50?'disabled':''}>+</button>
          </div>
        `;
        ul.appendChild(li);

        if (parseInt(item.count,10) > 0) {
          li.querySelector('.item-name').classList.add('active');
          li.querySelector('.counter').classList.add('active');
          li.querySelector('.counter-value').style.fontWeight = 'bold';
        }
        wireRow(li);
      });
    }

    // Wire swipe events to an <li>
    function wireRow(li) {
      li.addEventListener('touchstart', handleTouchStart, {passive:true});
      li.addEventListener('touchmove',  handleTouchMove,  {passive:true});
      li.addEventListener('touchend',   handleTouchEnd);
    }
    function getListName(li) {
      return li.closest('ul').id;
    }

    // (Already defined above)
    let handleTouchStart = () => {},
        handleTouchMove  = () => {},
        handleTouchEnd   = () => {};
    // They were set by setupSwipe() above

  </script>
</body>
</html>
