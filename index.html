<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Grocery Lists</title>
  <style>
    :root {
      --veggies-color: #4caf50;
      --grocery-color: #2196f3;
      --indian-color: #ff9800;
      --checked-color: #e9ecef;
      --master-check-color: #673ab7;
      --reset-color: #f44336;
      --share-color: #4caf50;
      --counter-highlight: #fff9c4;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 15px;
      background-color: #f5f7fa;
      color: #333;
      font-size: 21.6px; /* Increased by 20% */
      padding-bottom: 80px;
      padding-top: 70px; /* Reduced top padding */
      touch-action: pan-y;
    }

    .action-buttons {
      position: fixed;
      top: 15px;
      left: 15px;
      right: 15px;
      display: flex;
      justify-content: flex-start; /* Changed to flex-start */
      gap: 10px; /* Added gap between buttons */
      z-index: 100;
    }

    .action-btn {
      width: 36px; /* Reduced size */
      height: 36px; /* Reduced size */
      border-radius: 50%;
      color: white;
      border: none;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .master-check {
      background-color: var(--master-check-color);
    }

    .reset-btn {
      background-color: var(--reset-color);
    }

    .share-btn {
      background-color: var(--share-color);
      font-size: 1rem; /* Smaller icon */
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 25px;
      font-size: 2.16rem; /* Increased by 20% */
    }

    .table-container {
      margin-bottom: 30px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      overflow: hidden;
    }

    .table-header {
      padding: 15px;
      font-weight: bold;
      font-size: 1.56rem; /* Increased by 20% */
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    #veggies-header { background-color: var(--veggies-color); }
    #grocery-header { background-color: var(--grocery-color); }
    #indian-header  { background-color: var(--indian-color); }

    .collapse-btn {
      background: none;
      border: none;
      color: white;
      font-size: 1.8rem; /* Increased by 20% */
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      transition: all 0.3s ease;
    }

    tr {
      transition: all 0.3s ease;
      border-bottom: 1px solid #eee;
      position: relative;
      overflow: hidden;
    }

    tr.swipe-delete {
      transform: translateX(-100%);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    tr.checked {
      background-color: var(--checked-color) !important;
      color: #6c757d;
    }

    tr.checked .item-name {
      text-decoration: line-through;
      opacity: 0.7;
    }

    td {
      padding: 12px 10px;
    }

    .row-content {
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
      width: 100%;
    }

    .row-checkbox {
      width: 31.2px; /* Increased by 20% */
      height: 31.2px; /* Increased by 20% */
      appearance: none;
      border: 2px solid #666;
      border-radius: 4px;
      position: relative;
      cursor: pointer;
      flex-shrink: 0;
    }

    .row-checkbox:checked {
      background-color: #666;
      border-color: #666;
    }

    .row-checkbox:checked::after {
      content: "✓";
      color: white;
      font-size: 21.6px; /* Increased by 20% */
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    #veggies-items .row-checkbox:checked {
      background-color: var(--veggies-color);
      border-color: var(--veggies-color);
    }

    #grocery-items .row-checkbox:checked {
      background-color: var(--grocery-color);
      border-color: var(--grocery-color);
    }

    #indian-items .row-checkbox:checked {
      background-color: var(--indian-color);
      border-color: var(--indian-color);
    }

    .item-name {
      flex: 1;
      min-width: 0;
      font-size: 1.92rem; /* Increased by 20% */
      padding: 7.2px; /* Increased by 20% */
      border: none;
      background: transparent;
      outline: none;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .counter {
      display: flex;
      align-items: center;
      gap: 6px; /* Increased by 20% */
      margin-left: auto;
      flex-shrink: 0;
      background-color: transparent;
      transition: background-color 0.3s ease;
    }

    .counter.highlight {
      background-color: var(--counter-highlight);
      border-radius: 20px;
      padding: 0 5px;
    }

    .counter-btn {
      width: 38.4px; /* Increased by 20% */
      height: 38.4px; /* Increased by 20% */
      border-radius: 50%;
      border: none;
      color: white;
      font-weight: bold;
      font-size: 1.2rem; /* Increased by 20% */
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      flex-shrink: 0;
    }

    #veggies-items .counter-btn {
      background-color: var(--veggies-color);
    }

    #grocery-items .counter-btn {
      background-color: var(--grocery-color);
    }

    #indian-items .counter-btn {
      background-color: var(--indian-color);
    }

    .counter-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .counter-value {
      min-width: 30px; /* Increased by 20% */
      text-align: center;
      font-size: 1.32rem; /* Increased by 20% */
      flex-shrink: 0;
    }

    .add-row {
      display: flex;
      justify-content: flex-end;
      padding: 12px 15px;
    }

    .add-btn {
      width: 48px; /* Increased by 20% */
      height: 48px; /* Increased by 20% */
      border-radius: 50%;
      color: white;
      border: none;
      font-size: 1.8rem; /* Increased by 20% */
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    #veggies-add { background-color: var(--veggies-color); }
    #grocery-add { background-color: var(--grocery-color); }
    #indian-add  { background-color: var(--indian-color); }

    .swipe-delete-indicator {
      position: absolute;
      right: -100px;
      top: 0;
      bottom: 0;
      width: 100px;
      background-color: #f44336;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      transition: right 0.3s ease;
      font-size: 1.2rem; /* Increased by 20% */
    }

    .undo-notification {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: white;
      padding: 12px 24px; /* Increased by 20% */
      border-radius: 6px; /* Increased by 20% */
      display: flex;
      align-items: center;
      gap: 12px; /* Increased by 20% */
      z-index: 1000;
      font-size: 1.2rem; /* Increased by 20% */
    }

    .undo-btn {
      background-color: var(--share-color);
      color: white;
      border: none;
      padding: 6px 12px; /* Increased by 20% */
      border-radius: 3.6px; /* Increased by 20% */
      cursor: pointer;
      font-size: 1.2rem; /* Increased by 20% */
    }

    @media (max-width: 600px) {
      body {
        font-size: 19.2px; /* Increased by 20% */
        padding: 10px;
        padding-top: 70px; /* Reduced top padding */
      }

      .action-btn {
        width: 32px; /* Reduced size */
        height: 32px; /* Reduced size */
        font-size: 1rem;
      }

      .item-name {
        font-size: 1.44rem; /* Increased by 20% */
        max-width: 150px;
      }

      td {
        padding: 10px 8px;
      }

      .counter-btn {
        width: 36px; /* Increased by 20% */
        height: 36px; /* Increased by 20% */
      }

      .counter-value {
        min-width: 24px; /* Increased by 20% */
        font-size: 1.2rem; /* Increased by 20% */
      }
    }

    @media (max-width: 400px) {
      .item-name {
        max-width: 120px;
      }
      
      .action-buttons {
        gap: 8px;
      }
      
      .action-btn {
        width: 30px;
        height: 30px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="action-buttons">
    <button class="action-btn master-check" onclick="toggleAllCheckboxes()" title="Toggle all checkboxes">✓</button>
    <button class="action-btn reset-btn" onclick="resetAll()">🔄</button>
    <button class="action-btn share-btn" onclick="shareList()">⤴</button>
  </div>
  
  <h1>My Grocery Lists</h1>

  <div class="table-container">
    <div class="table-header" id="veggies-header" onclick="toggleCollapse('veggies')">
      Veggies
      <button class="collapse-btn">▼</button>
    </div>
    <table id="veggies-table">
      <tbody id="veggies-items"></tbody>
    </table>
    <div class="add-row">
      <button class="add-btn" id="veggies-add" onclick="addRow('veggies')">+</button>
    </div>
  </div>

  <div class="table-container">
    <div class="table-header" id="grocery-header" onclick="toggleCollapse('grocery')">
      Grocery
      <button class="collapse-btn">▼</button>
    </div>
    <table id="grocery-table">
      <tbody id="grocery-items"></tbody>
    </table>
    <div class="add-row">
      <button class="add-btn" id="grocery-add" onclick="addRow('grocery')">+</button>
    </div>
  </div>

  <div class="table-container">
    <div class="table-header" id="indian-header" onclick="toggleCollapse('indian')">
      Indian Store
      <button class="collapse-btn">▼</button>
    </div>
    <table id="indian-table">
      <tbody id="indian-items"></tbody>
    </table>
    <div class="add-row">
      <button class="add-btn" id="indian-add" onclick="addRow('indian')">+</button>
    </div>
  </div>

  <script>
    // Initialize tables and state
    const tables = {
      veggies: { id: 'veggies-items', collapsed: false },
      grocery: { id: 'grocery-items', collapsed: false },
      indian: { id: 'indian-items', collapsed: false }
    };

    const defaultItems = {
      veggies: ["टमाटर", "Avocado", "Pears", "अदरक", "कद्दू", "केले", "नींबू", "पालक", "पुदीना", 
                "प्याज", "बैंगन", "भिंडी", "मेथी", "लाल सेब", "शकरकंदी", "हरा धनिया", "हरे सेब", 
                "खीरा", "Avocado", "Beans", "Beetroot", "Broccoli", "Corn", "Kiwi", "अंगूर", 
                "गाजर", "तरबूज", "पपीता", "प्याज", "लहसुन", "लोकी", "शिमला मिर्च", 
                "संतरे (Kunal)", "संतरे for जूस"],
      grocery: ["Bin bags", "Bread", "Buns", "Chicken", "Chicken Ng.", "Detergent", 
                "Dish Tablets", "Dish. Liquid", "Dish. Ringe.", "Eggs", "Full Cr. Milk", 
                "Hard Butter", "Kids Snack", "Pizza Base", "Pizza Cheese", "Potato", 
                "Pre-wash", "Soft Butter", "Sugar", "Woolwash"],
      indian: ["आटा", "चावल", "पोहा", "दाल:", "राई", "दलिया", "बेसन", "सरसों तेल"]
    };

    // Variables for swipe-to-delete functionality
    let touchStartX = 0;
    let touchEndX = 0;
    let currentRow = null;
    let deletedRows = [];

    // Load saved data or default items
    document.addEventListener('DOMContentLoaded', () => {
      // Load collapsed states
      const collapsedStates = JSON.parse(localStorage.getItem('collapsedStates')) || {};
      for (const tableName in tables) {
        tables[tableName].collapsed = collapsedStates[tableName] || false;
        updateCollapseUI(tableName);
        
        // Check if table data exists in localStorage
        const savedData = localStorage.getItem(tableName);
        if (!savedData) {
          // If no saved data, load default items
          const defaultData = defaultItems[tableName].map(item => ({
            checked: false,
            count: "0",
            name: item
          }));
          localStorage.setItem(tableName, JSON.stringify(defaultData));
        }
        loadTable(tableName);
      }
      
      // Set up swipe event listeners
      setupSwipeHandlers();
    });

    // Set up swipe event handlers for all rows
    function setupSwipeHandlers() {
      document.querySelectorAll('tr').forEach(row => {
        row.addEventListener('touchstart', handleTouchStart, { passive: true });
        row.addEventListener('touchmove', handleTouchMove, { passive: true });
        row.addEventListener('touchend', handleTouchEnd);
      });
    }

    function handleTouchStart(e) {
      // Don't start swipe if clicking on counter buttons or checkbox
      if (e.target.classList.contains('counter-btn') || 
          e.target.classList.contains('row-checkbox') ||
          e.target.classList.contains('item-name')) {
        return;
      }
      
      touchStartX = e.changedTouches[0].screenX;
      currentRow = e.target.closest('tr');
      
      // Create delete indicator if it doesn't exist
      if (!currentRow.querySelector('.swipe-delete-indicator')) {
        const indicator = document.createElement('div');
        indicator.className = 'swipe-delete-indicator';
        indicator.textContent = 'DELETE';
        currentRow.style.position = 'relative';
        currentRow.appendChild(indicator);
      }
    }

    function handleTouchMove(e) {
      if (!currentRow) return;
      
      touchEndX = e.changedTouches[0].screenX;
      const diff = touchStartX - touchEndX;
      const threshold = window.innerWidth * 0.5; // 50% of screen width
      
      if (diff > 30) {
        const translateX = Math.min(diff, threshold);
        currentRow.style.transform = `translateX(-${translateX}px)`;
        
        // Show delete indicator when reaching 30% of threshold
        const indicator = currentRow.querySelector('.swipe-delete-indicator');
        if (indicator) {
          indicator.style.right = `${-translateX}px`;
        }
      }
    }

    function handleTouchEnd() {
      if (!currentRow) return;
      
      const diff = touchStartX - touchEndX;
      const threshold = window.innerWidth * 0.5; // 50% of screen width
      
      // Only delete if swiped at least 50% of screen width
      if (diff > threshold) {
        deleteRowWithUndo(currentRow);
      } else {
        // Return to original position
        currentRow.style.transform = '';
        const indicator = currentRow.querySelector('.swipe-delete-indicator');
        if (indicator) {
          indicator.style.right = '-100px';
        }
      }
      
      currentRow = null;
    }

    function deleteRowWithUndo(row) {
      const tableName = getTableNameFromRow(row);
      row.classList.add('swipe-delete');
      
      // Store deleted row for possible undo
      const rowData = {
        id: row.id,
        html: row.innerHTML,
        tableName: tableName
      };
      deletedRows.push(rowData);
      
      // Show undo notification
      showUndoNotification();
      
      // Remove row after animation completes
      setTimeout(() => {
        if (!rowData.undo) {
          row.remove();
          saveTable(tableName);
        }
      }, 300);
    }

    function showUndoNotification() {
      const notification = document.createElement('div');
      notification.className = 'undo-notification';
      notification.innerHTML = `
        Item deleted <button class="undo-btn" onclick="undoLastDelete()">UNDO</button>
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
        // If not undone, remove from deletedRows
        if (deletedRows.length > 0 && !deletedRows[deletedRows.length - 1].undo) {
          const rowData = deletedRows.pop();
          const row = document.getElementById(rowData.id);
          if (row) row.remove();
        }
      }, 5000);
    }

    function undoLastDelete() {
      if (deletedRows.length > 0) {
        const rowData = deletedRows.pop();
        rowData.undo = true;
        
        const tbody = document.getElementById(tables[rowData.tableName].id);
        const row = document.getElementById(rowData.id);
        
        if (row) {
          row.classList.remove('swipe-delete');
          row.style.transform = '';
          const indicator = row.querySelector('.swipe-delete-indicator');
          if (indicator) {
            indicator.style.right = '-100px';
          }
        } else {
          const newRow = document.createElement('tr');
          newRow.id = rowData.id;
          newRow.innerHTML = rowData.html;
          tbody.appendChild(newRow);
          
          // Reattach event listeners
          newRow.querySelector('.row-checkbox').addEventListener('change', function() {
            toggleRow(this, rowData.tableName);
          });
          
          const counterBtns = newRow.querySelectorAll('.counter-btn');
          counterBtns[0].addEventListener('click', function() {
            changeCounter(this, -1);
          });
          counterBtns[1].addEventListener('click', function() {
            changeCounter(this, 1);
          });
          
          // Set up swipe events for new row
          newRow.addEventListener('touchstart', handleTouchStart, { passive: true });
          newRow.addEventListener('touchmove', handleTouchMove, { passive: true });
          newRow.addEventListener('touchend', handleTouchEnd);
        }
      }
    }

    // Table collapse functionality
    function toggleCollapse(tableName) {
      tables[tableName].collapsed = !tables[tableName].collapsed;
      updateCollapseUI(tableName);
      
      // Save collapsed state
      const collapsedStates = {};
      for (const name in tables) {
        collapsedStates[name] = tables[name].collapsed;
      }
      localStorage.setItem('collapsedStates', JSON.stringify(collapsedStates));
    }

    function updateCollapseUI(tableName) {
      const table = document.getElementById(`${tableName}-table`);
      const collapseBtn = document.querySelector(`#${tableName}-header .collapse-btn`);
      
      if (tables[tableName].collapsed) {
        table.style.display = 'none';
        collapseBtn.textContent = '▶';
      } else {
        table.style.display = 'table';
        collapseBtn.textContent = '▼';
      }
    }

    // Share functionality
    function shareList() {
      const allData = {};
      for (const tableName in tables) {
        allData[tableName] = JSON.parse(localStorage.getItem(tableName)) || [];
      }
      
      const shareText = Object.entries(allData).map(([tableName, items]) => {
        return `${tableName.toUpperCase()}:\n${items.map(item => 
          `${item.checked ? '✓' : '◻'} ${item.name} (${item.count})`
        ).join('\n')}`;
      }).join('\n\n');
      
      if (navigator.share) {
        navigator.share({
          title: 'My Grocery List',
          text: shareText,
          url: window.location.href
        }).catch(err => {
          console.log('Error sharing:', err);
          copyToClipboard(shareText);
        });
      } else {
        copyToClipboard(shareText);
      }
    }

    function copyToClipboard(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      alert('List copied to clipboard!');
    }

    // Reset all functionality
    function resetAll() {
      if (confirm('Are you sure you want to reset everything? This will:\n\n- Set all counters to 0\n- Uncheck all items\n- Expand all tables')) {
        // Reset counters and checkboxes
        document.querySelectorAll('.row-checkbox').forEach(checkbox => {
          checkbox.checked = false;
          const row = checkbox.closest('tr');
          row.classList.remove('checked');
        });
        
        document.querySelectorAll('.counter-value').forEach(span => {
          span.textContent = '0';
        });
        
        document.querySelectorAll('.counter-btn').forEach(btn => {
          const isMinus = btn.textContent === '-';
          btn.disabled = isMinus;
        });
        
        // Remove all highlights
        document.querySelectorAll('.counter').forEach(counter => {
          counter.classList.remove('highlight');
        });
        
        // Expand all tables
        for (const tableName in tables) {
          tables[tableName].collapsed = false;
          updateCollapseUI(tableName);
        }
        
        // Save all tables
        for (const tableName in tables) {
          const rows = document.getElementById(tables[tableName].id).querySelectorAll('tr');
          const data = Array.from(rows).map(row => ({
            checked: false,
            count: "0",
            name: row.querySelector('.item-name').value
          }));
          localStorage.setItem(tableName, JSON.stringify(data));
        }
        
        // Save collapsed states
        const collapsedStates = {};
        for (const name in tables) {
          collapsedStates[name] = false;
        }
        localStorage.setItem('collapsedStates', JSON.stringify(collapsedStates));
      }
    }

    function addRow(tableName) {
      const tableId = tables[tableName].id;
      const tbody = document.getElementById(tableId);
      const rowId = 'row-' + Date.now();

      const row = document.createElement('tr');
      row.id = rowId;
      row.innerHTML = `
        <td>
          <div class="row-content">
            <input type="checkbox" class="row-checkbox" onchange="toggleRow(this, '${tableName}')">
            <input type="text" class="item-name" placeholder="Item name" oninput="saveTable('${tableName}')">
            <div class="counter">
              <button class="counter-btn" onclick="changeCounter(this, -1)" disabled>-</button>
              <span class="counter-value">0</span>
              <button class="counter-btn" onclick="changeCounter(this, 1)">+</button>
            </div>
          </div>
        </td>
      `;
      tbody.appendChild(row);
      
      // Set up swipe events for new row
      row.addEventListener('touchstart', handleTouchStart, { passive: true });
      row.addEventListener('touchmove', handleTouchMove, { passive: true });
      row.addEventListener('touchend', handleTouchEnd);
      
      saveTable(tableName);
    }

    function changeCounter(button, change) {
      const counter = button.parentElement;
      const valueSpan = counter.querySelector('.counter-value');
      let value = parseInt(valueSpan.textContent);
      value = Math.max(0, Math.min(50, value + change));
      valueSpan.textContent = value;
      
      const minusBtn = counter.querySelector('.counter-btn:first-child');
      const plusBtn = counter.querySelector('.counter-btn:last-child');
      minusBtn.disabled = value <= 0;
      plusBtn.disabled = value >= 50;

      // Highlight counter when value changes
      if (change !== 0) {
        counter.classList.add('highlight');
        setTimeout(() => {
          counter.classList.remove('highlight');
        }, 2000);
      }

      saveTable(getTableNameFromRow(button.closest('tr')));
    }

    function toggleRow(checkbox, tableName) {
      const row = checkbox.closest('tr');
      row.classList.toggle('checked', checkbox.checked);
      saveTable(tableName);
    }

    function toggleAllCheckboxes() {
      if (confirm('Do you want to toggle all checkboxes? Press Cancel to keep current state.')) {
        const checkboxes = document.querySelectorAll('.row-checkbox');
        const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
        checkboxes.forEach(cb => {
          cb.checked = !anyChecked;
          const row = cb.closest('tr');
          row.classList.toggle('checked', cb.checked);
        });
        
        for (const tableName in tables) {
          saveTable(tableName);
        }
      }
    }

    function saveTable(tableName) {
      const rows = document.getElementById(tables[tableName].id).querySelectorAll('tr');
      const data = Array.from(rows).map(row => ({
        checked: row.querySelector('.row-checkbox').checked,
        count: row.querySelector('.counter-value').textContent,
        name: row.querySelector('.item-name').value
      }));
      localStorage.setItem(tableName, JSON.stringify(data));
    }

    function loadTable(tableName) {
      const data = JSON.parse(localStorage.getItem(tableName)) || [];
      const tbody = document.getElementById(tables[tableName].id);
      tbody.innerHTML = '';
      
      data.forEach(item => {
        const rowId = 'row-' + Date.now() + Math.random().toString(36).substr(2, 9);
        const row = document.createElement('tr');
        row.id = rowId;
        
        if (item.checked) row.classList.add('checked');
        
        row.innerHTML = `
          <td>
            <div class="row-content">
              <input type="checkbox" class="row-checkbox" onchange="toggleRow(this, '${tableName}')" ${item.checked ? 'checked' : ''}>
              <input type="text" class="item-name" value="${item.name}" oninput="saveTable('${tableName}')">
              <div class="counter">
                <button class="counter-btn" onclick="changeCounter(this, -1)" ${item.count <= 0 ? 'disabled' : ''}>-</button>
                <span class="counter-value">${item.count}</span>
                <button class="counter-btn" onclick="changeCounter(this, 1)" ${item.count >= 50 ? 'disabled' : ''}>+</button>
              </div>
            </div>
          </td>
        `;
        tbody.appendChild(row);
        
        // Set up swipe events for loaded row
        row.addEventListener('touchstart', handleTouchStart, { passive: true });
        row.addEventListener('touchmove', handleTouchMove, { passive: true });
        row.addEventListener('touchend', handleTouchEnd);
      });
    }

    function getTableNameFromRow(row) {
      const tableId = row.closest('tbody').id;
      return Object.keys(tables).find(name => tables[name].id === tableId);
    }
  </script>
</body>
</html>
