<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Grocery List</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    header {
      background: #4caf50;
      color: white;
      padding: 1em;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      padding: 0.5em 1em;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 60px;
      z-index: 9;
    }
    .table-container {
      margin: 1em;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .table-header {
      background: #2196f3;
      color: white;
      padding: 1em;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    td {
      padding: 0.5em;
      border-bottom: 1px solid #eee;
    }
    .row-content {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .counter {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-left: auto;
    }
    .counter-btn {
      width: 24px;
      height: 24px;
      text-align: center;
      border: none;
      border-radius: 50%;
      background: #4caf50;
      color: white;
      cursor: pointer;
    }
    .undo-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #ff9800;
      color: white;
      text-align: center;
      padding: 1em;
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>My Grocery List</h1>
  </header>
  <div class="controls">
    <button onclick="resetAll()">üîÅ Reset</button>
    <button onclick="shareList()">üì§ Share</button>
  </div>

  <div class="table-container">
    <div class="table-header" onclick="toggleCollapse('veggies')">
      Veggies
      <span id="veggies-toggle">[-]</span>
    </div>
    <table id="veggies-table">
      <tbody id="veggies-items"></tbody>
    </table>
    <div style="padding: 0.5em; text-align: right;">
      <button onclick="addItem('veggies')">‚ûï Add</button>
    </div>
  </div>

  <div class="table-container">
    <div class="table-header" onclick="toggleCollapse('grocery')">
      Grocery
      <span id="grocery-toggle">[-]</span>
    </div>
    <table id="grocery-table">
      <tbody id="grocery-items"></tbody>
    </table>
    <div style="padding: 0.5em; text-align: right;">
      <button onclick="addItem('grocery')">‚ûï Add</button>
    </div>
  </div>

  <div class="table-container">
    <div class="table-header" onclick="toggleCollapse('indian')">
      Indian Store
      <span id="indian-toggle">[-]</span>
    </div>
    <table id="indian-table">
      <tbody id="indian-items"></tbody>
    </table>
    <div style="padding: 0.5em; text-align: right;">
      <button onclick="addItem('indian')">‚ûï Add</button>
    </div>
  </div>

  <div class="undo-banner" id="undo-banner">
    Item deleted. <button onclick="undoDelete()">UNDO</button>
  </div>

  <script>
    const defaultItems = {
      veggies: ["‡§ü‡§Æ‡§æ‡§ü‡§∞", "Avocado", "Pears", "‡§Ö‡§¶‡§∞‡§ï"],
      grocery: ["Bin bags", "Bread", "Eggs", "Milk"],
      indian: ["‡§Ü‡§ü‡§æ", "‡§ö‡§æ‡§µ‡§≤", "‡§¶‡§æ‡§≤", "‡§¨‡•á‡§∏‡§®"]
    };

    const deletedItems = [];

    function loadDefaults() {
      for (const key in defaultItems) {
        const tbody = document.getElementById(`${key}-items`);
        defaultItems[key].forEach(name => {
          const row = createRow(key, name);
          tbody.appendChild(row);
        });
      }
    }

    function createRow(category, name, count = 0) {
      const row = document.createElement('tr');
      const td = document.createElement('td');
      td.innerHTML = `
        <div class="row-content">
          <input type="checkbox" onchange="saveState()">
          <input type="text" value="${name}" oninput="saveState()">
          <div class="counter">
            <button class="counter-btn" onclick="changeCount(this, -1)">-</button>
            <span>${count}</span>
            <button class="counter-btn" onclick="changeCount(this, 1)">+</button>
          </div>
        </div>
      `;
      row.appendChild(td);
      row.setAttribute('draggable', true);
      row.addEventListener('touchstart', handleTouchStart, {passive: true});
      row.addEventListener('touchmove', handleTouchMove, {passive: true});
      row.dataset.category = category;
      return row;
    }

    function addItem(category) {
      const tbody = document.getElementById(`${category}-items`);
      const row = createRow(category, '');
      tbody.appendChild(row);
    }

    function changeCount(button, delta) {
      const span = button.parentElement.querySelector('span');
      let count = parseInt(span.textContent);
      count = Math.max(0, count + delta);
      span.textContent = count;
      saveState();
    }

    function toggleCollapse(section) {
      const table = document.getElementById(`${section}-table`);
      const toggle = document.getElementById(`${section}-toggle`);
      const hidden = table.style.display === 'none';
      table.style.display = hidden ? '' : 'none';
      toggle.textContent = hidden ? '[-]' : '[+]';
    }

    function resetAll() {
      if (confirm('Reset all counters, checkboxes, and expand tables?')) {
        document.querySelectorAll('input[type=checkbox]').forEach(cb => cb.checked = false);
        document.querySelectorAll('.counter span').forEach(span => span.textContent = '0');
        document.querySelectorAll('table').forEach(table => table.style.display = '');
        document.querySelectorAll('[id$=-toggle]').forEach(toggle => toggle.textContent = '[-]');
        saveState();
      }
    }

    function shareList() {
      const text = [...document.querySelectorAll('table')].map(table => {
        return [...table.querySelectorAll('tr')].map(row => {
          const name = row.querySelector('input[type=text]').value;
          const count = row.querySelector('.counter span').textContent;
          const checked = row.querySelector('input[type=checkbox]').checked;
          return `${checked ? '‚úÖ' : '‚¨ú'} ${name} x${count}`;
        }).join('\n');
      }).join('\n\n');
      const url = `mailto:?subject=My Grocery List&body=${encodeURIComponent(text)}`;
      window.open(url);
    }

    function saveState() {
      // optionally implement persistent storage
    }

    let xStart = null;
    function handleTouchStart(e) {
      xStart = e.touches[0].clientX;
    }

    function handleTouchMove(e) {
      if (!xStart) return;
      const xDiff = xStart - e.touches[0].clientX;
      if (xDiff > 50) {
        const row = e.target.closest('tr');
        deletedItems.push({
          category: row.dataset.category,
          row: row.cloneNode(true)
        });
        row.remove();
        showUndo();
        xStart = null;
        saveState();
      }
    }

    function showUndo() {
      const banner = document.getElementById('undo-banner');
      banner.style.display = 'block';
      setTimeout(() => banner.style.display = 'none', 5000);
    }

    function undoDelete() {
      const last = deletedItems.pop();
      if (last) {
        document.getElementById(`${last.category}-items`).appendChild(last.row);
        saveState();
      }
      document.getElementById('undo-banner').style.display = 'none';
    }

    window.onload = loadDefaults;
  </script>
</body>
</html>
